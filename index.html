<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Comunidade de Memes</title>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; color: #333; min-height: 100vh; display: flex; flex-direction: column; }
    header { background: #4a90e2; padding: 15px 20px; text-align: center; color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: relative; }
    header h1 { margin: 0; font-weight: 600; font-size: 28px; }
    #userPic { position: absolute; top: 10px; right: 60px; width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid white; display: none; cursor: pointer; }
    #logoutBtn { position: absolute; top: 10px; right: 10px; background: #ff4d4d; color: white; border: none; padding: 8px 10px; border-radius: 5px; cursor: pointer; display: none; font-weight: 600; }
    nav { display: flex; flex-wrap: wrap; justify-content: center; background: #fff; border-bottom: 1px solid #ddd; }
    nav button { background: none; border: none; color: #4a90e2; padding: 12px 20px; font-size: 16px; cursor: pointer; transition: background 0.3s ease, color 0.3s ease; border-bottom: 3px solid transparent; }
    nav button:hover { background: #e6f0fb; }
    nav button.active { border-bottom: 3px solid #4a90e2; font-weight: 700; }
    main { flex: 1; padding: 30px 20px; max-width: 900px; margin: auto; width: 100%; }
    section { display: none; }
    section.active { display: block; }
    form { max-width: 420px; margin: auto; background: #fff; padding: 25px 30px; border-radius: 8px; box-shadow: 0 2px 6px rgba(74,144,226,0.15); display: flex; flex-direction: column; gap: 15px; }
    input, textarea { padding: 12px 15px; font-size: 16px; border: 1.5px solid #ccc; border-radius: 6px; transition: border-color 0.3s ease; font-family: inherit; resize: vertical; }
    input:focus, textarea:focus { outline: none; border-color: #4a90e2; box-shadow: 0 0 5px rgba(74,144,226,0.5); }
    input[type="submit"], button.submit-btn { background: #4a90e2; color: white; font-weight: 600; cursor: pointer; border: none; padding: 12px 0; border-radius: 6px; font-size: 18px; transition: background 0.3s ease; }
    input[type="submit"]:hover, button.submit-btn:hover { background: #357ABD; }
    .message { text-align: center; margin: 10px 0; font-weight: 600; color: #e74c3c; min-height: 20px; }
    .meme { background: white; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); position: relative; }
    .meme video, .meme img { max-width: 100%; border-radius: 10px; cursor: pointer; margin-bottom: 10px; box-shadow: 0 1px 5px rgba(74,144,226,0.2); }
    .admin-panel { display: none; position: absolute; top: 10px; right: 10px; background: #ff4d4d; padding: 10px; border-radius: 8px; z-index: 10; box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
    .admin-panel button { display: block; background: white; color: #ff4d4d; border: none; padding: 6px 10px; border-radius: 4px; margin-bottom: 6px; cursor: pointer; font-size: 14px; font-weight: 600; transition: background 0.2s ease; }
    .admin-panel button:hover { background: #ff9999; }
    footer { text-align: center; padding: 15px 10px; background: #f1f3f6; color: #666; font-size: 14px; margin-top: auto; border-top: 1px solid #ddd; }
    .like-btn { background: none; border: none; cursor: pointer; color: #e74c3c; font-size: 16px; margin-right: 10px; }
    .report-btn { background: none; border: none; cursor: pointer; color: #f39c12; font-size: 16px; margin-right: 10px; }
    .comment-section { margin-top: 10px; }
    .comment-section p { background: #f5f5f5; padding: 5px 8px; border-radius: 5px; margin: 4px 0; font-size: 14px; }
    .comment-section form { display: flex; gap: 5px; background: none; box-shadow: none; padding: 0; }
    .comment-section input { flex: 1; }
  </style>
</head>
<body>

<header>
  <h1>Comunidade de Memes</h1>
  <img id="userPic" alt="Foto do usuário" />
  <button id="logoutBtn">Sair</button>
</header>

<nav>
  <button class="tab-btn active" data-tab="home">Início</button>
  <button class="tab-btn" data-tab="login">Login</button>
  <button class="tab-btn" data-tab="signup">Criar Conta</button>
  <button class="tab-btn" data-tab="add">Adicionar Meme</button>
  <button class="tab-btn" data-tab="memes">Ver Memes</button>
  <button class="tab-btn" data-tab="rules">Regras</button>
  <button class="tab-btn" data-tab="reports">Denúncias</button>
</nav>

<main>
  <section id="home" class="active">
    <h2>Bem-vindo!</h2>
  </section>

  <section id="login">
    <form id="loginForm">
      <input type="text" id="loginUser" placeholder="Usuário" required />
      <input type="password" id="loginPass" placeholder="Senha" required />
      <input type="text" id="loginSecret" placeholder="Código Secreto (admin)" />
      <input type="submit" value="Entrar" />
      <div class="message" id="loginMessage"></div>
    </form>
  </section>

  <section id="signup">
    <form id="signupForm">
      <input type="text" id="signupUser" placeholder="Usuário" required />
      <input type="password" id="signupPass" placeholder="Senha" required />
      <input type="file" id="signupPic" accept="image/*" required />
      <input type="submit" value="Criar Conta" />
      <div class="message" id="signupMessage"></div>
    </form>
  </section>

  <section id="add">
    <form id="memeForm">
      <button type="button" id="uploadBtn">Upload Meme (Cloudinary)</button>
      <input type="hidden" id="memeFileUrl" />
      <textarea id="memeText" placeholder="Texto do meme (opcional)"></textarea>
      <input type="submit" value="Postar Meme" />
      <div class="message" id="memeMessage"></div>
    </form>
  </section>

  <section id="memes">
    <div id="memeList"></div>
  </section>

  <section id="rules">
    <h2>Regras da Comunidade</h2>
    <ul>
      <li>Proibido pornografia.</li>
      <li>Proibido meme com pornografia.</li>
      <li>Proibido meme com partes sexuais mostrando.</li>
      <li>Proibido conteúdo racista.</li>
    </ul>
  </section>

  <section id="reports">
    <h2>Denúncias</h2>
    <div id="reportList"></div>
  </section>
</main>

<footer>
  &copy; 🔥2025 Comunidade de Memes feita por capkzy🔥💓
</footer>

<script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
<script>
  let currentUser = null;
  let users = JSON.parse(localStorage.getItem("users")) || {};
  let memes = JSON.parse(localStorage.getItem("memes")) || [];
  let reports = JSON.parse(localStorage.getItem("reports")) || [];
  const palavrasProibidas = ["porno","nude","sexo","nsfw","genital"];

  const myWidget = cloudinary.createUploadWidget({
    cloudName: 'djeqaxjf1',
    uploadPreset: 'sfnas6dp'
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      memeFileUrl.value = result.info.secure_url;
      memeMessage.style.color = "green";
      memeMessage.textContent = "Upload concluído!";
    }
  });

  uploadBtn.addEventListener("click", () => { myWidget.open(); }, false);

  function saveData() {
    localStorage.setItem("users", JSON.stringify(users));
    localStorage.setItem("memes", JSON.stringify(memes));
    localStorage.setItem("reports", JSON.stringify(reports));
  }

  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.onclick = () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      document.querySelectorAll("section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(btn.dataset.tab).classList.add("active");
      ["loginMessage","signupMessage","memeMessage"].forEach(id=>{
        const el=document.getElementById(id);
        if(el) el.textContent = "";
      });
      if(btn.dataset.tab === "reports") showReports();
    };
  });

  function updateUserPic() {
    if(currentUser && users[currentUser] && users[currentUser].pic){
      userPic.src = users[currentUser].pic;
      userPic.style.display = "block";
      logoutBtn.style.display = "inline-block";
    } else {
      userPic.style.display = "none";
      logoutBtn.style.display = "none";
    }
  }

  logoutBtn.onclick = () => {
    currentUser = null;
    updateUserPic();
    alert("Você saiu da conta.");
  };

  async function hashPassword(password) {
    const msgUint8 = new TextEncoder().encode(password);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
  }

  signupForm.onsubmit = async e => {
    e.preventDefault();
    const user = signupUser.value.trim();
    const pass = signupPass.value;
    const pic = signupPic.files[0];
    const msg = signupMessage;
    if (!user || !pass || !pic) { msg.textContent = "Preencha todos os campos."; msg.style.color = "red"; return; }
    if (users[user]) { msg.textContent = "Usuário já existe."; msg.style.color = "red"; return; }
    const hashed = await hashPassword(pass);
    const reader = new FileReader();
    reader.onload = () => {
      users[user] = { pass: hashed, pic: reader.result, friends: [], followers: [], isAdmin: user === "capkzy", banned: false };
      saveData();
      msg.style.color = "green";
      msg.textContent = "Conta criada!";
      signupForm.reset();
    };
    reader.readAsDataURL(pic);
  };

  loginForm.onsubmit = async e => {
    e.preventDefault();
    const user = loginUser.value.trim();
    const pass = loginPass.value;
    const secret = loginSecret.value;
    const msg = loginMessage;
    if (!users[user]) { msg.style.color = "red"; msg.textContent = "Usuário não encontrado."; return; }
    if (users[user].banned) { msg.style.color = "red"; msg.textContent = "Você foi banido."; return; }
    const hashed = await hashPassword(pass);
    if (users[user].pass !== hashed) { msg.style.color = "red"; msg.textContent = "Senha incorreta."; return; }
    if (secret && secret === "3x!AdmC0d3#2025") { users[user].isAdmin = true; saveData(); }
    currentUser = user;
    updateUserPic();
    msg.style.color = "green";
    msg.textContent = "Logado como " + user;
    loginForm.reset();
  };

  function contemConteudoProibido(texto) {
    const lower = texto.toLowerCase();
    return palavrasProibidas.some(palavra => lower.includes(palavra));
  }

  memeForm.onsubmit = e => {
    e.preventDefault();
    const fileUrl = memeFileUrl.value;
    const text = memeText.value;
    if (!currentUser) { memeMessage.style.color = "red"; memeMessage.textContent = "Você precisa estar logado."; return; }
    if (!fileUrl) { memeMessage.style.color = "red"; memeMessage.textContent = "Faça upload do meme."; return; }
    if (users[currentUser].banned) { memeMessage.style.color = "red"; memeMessage.textContent = "Você foi banido."; return; }
    if (contemConteudoProibido(text)) { memeMessage.style.color = "red"; memeMessage.textContent = "Conteúdo proibido detectado!"; return; }
    memes.unshift({ id: Date.now(), user: currentUser, pic: fileUrl, text, video: fileUrl.endsWith(".mp4") || fileUrl.includes("/video/"), likes: [], comments: [] });
    saveData();
    memeMessage.style.color = "green";
    memeMessage.textContent = "Meme postado!";
    memeForm.reset();
    showMemes();
  };

  function showMemes() {
    memeList.innerHTML = "";
    memes.forEach(meme => {
      const div = document.createElement("div");
      div.classList.add("meme");
      let mediaElement = meme.video ? document.createElement("video") : document.createElement("img");
      mediaElement.src = meme.pic;
      if(meme.video) mediaElement.controls = true;
      div.appendChild(mediaElement);

      const p = document.createElement("p");
      p.textContent = meme.text || "";
      div.appendChild(p);

      const small = document.createElement("small");
      small.textContent = `Postado por: ${meme.user}`;
      div.appendChild(small);

      const likeBtn = document.createElement("button");
      likeBtn.className = "like-btn";
      likeBtn.textContent = `❤️ ${meme.likes.length}`;
      likeBtn.onclick = () => {
        if (!currentUser) return alert("Você precisa estar logado.");
        const index = meme.likes.indexOf(currentUser);
        if (index === -1) meme.likes.push(currentUser); else meme.likes.splice(index, 1);
        saveData(); showMemes();
      };
      div.appendChild(likeBtn);

      const reportBtn = document.createElement("button");
      reportBtn.className = "report-btn";
      reportBtn.textContent = "🚨 Denunciar";
      reportBtn.onclick = () => {
        if (!currentUser) return alert("Você precisa estar logado.");
        reports.push({ memeId: meme.id, memeUser: meme.user, reporter: currentUser, text: meme.text });
        saveData();
        alert("Denúncia enviada!");
      };
      div.appendChild(reportBtn);

      const commentSection = document.createElement("div");
      commentSection.className = "comment-section";
      const commentForm = document.createElement("form");
      commentForm.innerHTML = `<input type="text" placeholder="Comentar..." required /><button type="submit">Enviar</button>`;
      commentForm.onsubmit = ev => {
        ev.preventDefault();
        if (!currentUser) return alert("Você precisa estar logado.");
        const input = commentForm.querySelector("input");
        meme.comments.push({ user: currentUser, text: input.value });
        input.value = "";
        saveData();
        showMemes();
      };
      commentSection.appendChild(commentForm);
      meme.comments.forEach(c => {
        const cp = document.createElement("p");
        cp.textContent = `${c.user}: ${c.text}`;
        commentSection.appendChild(cp);
      });
      div.appendChild(commentSection);

      if(users[currentUser] && users[currentUser].isAdmin){
        const adminPanel = document.createElement("div");
        adminPanel.classList.add("admin-panel");
        adminPanel.innerHTML = `<button class="ban-btn">Banir Usuário</button><button class="remove-btn">Remover Meme</button>`;
        div.appendChild(adminPanel);
        mediaElement.style.cursor = "pointer";
        mediaElement.onclick = () => { adminPanel.classList.toggle("show"); };
        adminPanel.querySelector(".ban-btn").onclick = () => {
          if(confirm(`Banir o usuário ${meme.user}?`)){
            users[meme.user].banned = true;
            saveData();
            alert(`${meme.user} foi banido.`);
            showMemes();
          }
        };
        adminPanel.querySelector(".remove-btn").onclick = () => {
          if(confirm("Remover este meme?")){
            memes = memes.filter(m => m.id !== meme.id);
            saveData();
            showMemes();
          }
        };
      }
      memeList.appendChild(div);
    });
  }

  function showReports() {
    reportList.innerHTML = "";
    if(!users[currentUser] || !users[currentUser].isAdmin){
      reportList.innerHTML = "<p>Somente administradores podem ver as denúncias.</p>";
      return;
    }
    if(reports.length === 0){
      reportList.innerHTML = "<p>Sem denúncias no momento.</p>";
      return;
    }
    reports.forEach((r, i) => {
      const div = document.createElement("div");
      div.className = "meme";
      div.innerHTML = `<p><b>Denunciado:</b> ${r.memeUser}</p><p><b>Por:</b> ${r.reporter}</p><p><b>Texto:</b> ${r.text || "(sem texto)"}</p>`;
      const removeReport = document.createElement("button");
      removeReport.textContent = "Excluir denúncia";
      removeReport.onclick = () => {
        reports.splice(i,1);
        saveData();
        showReports();
      };
      div.appendChild(removeReport);
      reportList.appendChild(div);
    });
  }

  updateUserPic();
  showMemes();
</script>

</body>
</html>
